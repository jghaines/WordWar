{
   "Description" : "WordWar environment template",

   "Parameters" : {
      "Env" : {
        "Type" : "String",
        "Default" : "",
        "Description" : "Name of the environment. Default is empty (=> prod). e.g. dev_ test_"
      }
   },

    "Resources" : {
        "GetGameLambda" : {
            "Type" : "AWS::Lambda::Function",
                "Properties" : {
                "Code"          : {
                    "S3Bucket"          : "wordwar-config",
                    "S3Key"             : { "Fn::Join" : [ "", [ "lambda/lambda", { "Ref" : "Env" }, ".zip" ]]}
                },
                "Description"   : "Connect to a pending game, or create a new one",
                "Handler"       : "index.getGame",
                "MemorySize"    : 128,
                "Role"          : "arn:aws:iam::458298098107:role/lambda_dynamo",
                "Runtime"       : "nodejs",
                "Timeout"       : 10
            }
        },
        "PutPlayLambda" : {
            "Type" : "AWS::Lambda::Function",
                "Properties" : {
                "Code"          : {
                    "S3Bucket"          : "wordwar-config",
                    "S3Key"             : { "Fn::Join" : [ "", [ "lambda/lambda", { "Ref" : "Env" }, ".zip" ]]}
                },
                "Description"   : "Execute a Play from the client",
                "Handler"       : "index.putPlay",
                "MemorySize"    : 128,
                "Role"          : "arn:aws:iam::458298098107:role/lambda_dynamo",
                "Runtime"       : "nodejs",
                "Timeout"       : 10
            }
        },
        "GameTable" : {
            "Type" : "AWS::DynamoDB::Table",
            "Properties" : {
                "TableName" : "Game",
                "KeySchema" : [ {
                    "KeyType" : "HASH",
                    "AttributeName" : "gameId"
                } ],
                "AttributeDefinitions" : [
                    {
                        "AttributeName" : "gameId",
                        "AttributeType" : "S"
                    }
                ],
                "ProvisionedThroughput" : {
                    "ReadCapacityUnits" :  5,
                    "WriteCapacityUnits" : 5
                }
            }
        },
       "PlayTable" : {
            "Type" : "AWS::DynamoDB::Table",
            "Properties" : {
                "TableName" : "Play",
                "KeySchema" : [
                    {
                        "KeyType" : "HASH",
                        "AttributeName" : "gameId_turnIndex"
                    },
                    {
                        "KeyType" : "RANGE",
                        "AttributeName" : "playerIndex"
                    }
                ],
                "AttributeDefinitions" : [
                    {
                        "AttributeName" : "gameId_turnIndex",
                        "AttributeType" : "S"
                    },
                    {
                        "AttributeName" : "playerIndex",
                        "AttributeType" : "N"
                    }
                ],
                "ProvisionedThroughput" : {
                    "ReadCapacityUnits" :  5,
                    "WriteCapacityUnits" : 5
                }
            }
        }
    }
}
